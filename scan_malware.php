<?php
/**
 * 🔍 HINO DEALER INDONESIA - SCANNER MALWARE & BACKDOOR
 * Versi aman untuk Hostinger (tanpa hapus file otomatis)
 * ======================================================
 * Script ini hanya membaca dan melaporkan file mencurigakan
 * agar kamu tahu lokasi malware tanpa merusak sistem.
 */

ini_set('max_execution_time', 300);
ini_set('memory_limit', '512M');
date_default_timezone_set('Asia/Jakarta');

// === KONFIGURASI ===
$scan_dir = __DIR__; // folder yang akan discan (default: public_html)
$report_file = __DIR__ . '/malware_report_' . date('Ymd_His') . '.txt';

// === POLA KATA MENCURIGAKAN ===
$suspicious_patterns = [
    'eval(',
    'base64_decode(',
    'gzinflate(',
    'str_rot13(',
    'shell_exec(',
    'passthru(',
    'system(',
    'popen(',
    'proc_open(',
    'assert(',
    'create_function(',
    'preg_replace.*\/e',
    'cmd='
];

// === FUNGSI PEMINDAIAN ===
function scanDirRecursive($dir, $patterns, &$results) {
    $files = scandir($dir);
    foreach ($files as $file) {
        if ($file === '.' || $file === '..') continue;
        $path = "$dir/$file";

        if (is_dir($path)) {
            scanDirRecursive($path, $patterns, $results);
        } elseif (is_file($path) && pathinfo($path, PATHINFO_EXTENSION) === 'php') {
            $content = @file_get_contents($path);
            if ($content === false) continue;

            foreach ($patterns as $pattern) {
                if (preg_match("/$pattern/i", $content)) {
                    $results[] = [
                        'file' => $path,
                        'pattern' => $pattern,
                        'modified' => date("Y-m-d H:i:s", filemtime($path)),
                        'size' => filesize($path)
                    ];
                    break;
                }
            }
        }
    }
}

// === JALANKAN PEMINDAIAN ===
echo "<pre>";
echo "==========================================\n";
echo "🛡️  SCAN MALWARE - DEALER HINO INDONESIA\n";
echo "==========================================\n";
echo "Scanning directory: $scan_dir\n\n";

$results = [];
scanDirRecursive($scan_dir, $suspicious_patterns, $results);

if (count($results) > 0) {
    $report = "🔴 DITEMUKAN " . count($results) . " FILE MENCURIGAKAN 🔴\n\n";
    foreach ($results as $r) {
        $report .= "📄 File: {$r['file']}\n";
        $report .= "    Pola: {$r['pattern']}\n";
        $report .= "    Ukuran: {$r['size']} byte\n";
        $report .= "    Terakhir diubah: {$r['modified']}\n\n";
    }

    file_put_contents($report_file, $report);
    echo $report;
    echo "📁 Laporan disimpan ke: $report_file\n";
} else {
    echo "✅ Tidak ditemukan pola mencurigakan di file PHP.\n";
}

echo "\nSelesai.\n";
echo "</pre>";
?>
